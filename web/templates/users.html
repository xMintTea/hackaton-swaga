<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberskill | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', path='css/main.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
</head>
<body>
    <div class="matrix-rain" id="matrixRain"></div>
    
    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–ª—è header -->
    <div id="header-placeholder"></div>
    
    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±–µ—Ä—Ç–∫–∞ —Å –∫–ª–∞—Å—Å–æ–º container –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
    <div class="container">
        <section class="users-section">
            <div class="section-title">
                <h2>–°–æ–æ–±—â–µ—Å—Ç–≤–æ –∫–∏–±–µ—Ä–ø–∏–æ–Ω–µ—Ä–æ–≤</h2>
                <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –ª—É—á—à–∏–º –∏–∑ –ª—É—á—à–∏—Ö –≤ –º–∏—Ä–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</p>
            </div>
            
            <div class="users-stats animate-on-scroll" data-animation="fadeInUp">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <h3>{{ users|length }}</h3>
                        <p>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üöÄ</div>
                    <div class="stat-info">
                        <h3>{{ (users|selectattr('is_online', 'equalto', True)|list)|length if users else 0 }}</h3>
                        <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–π—á–∞—Å</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-info">
                        <h3>{{ (users|selectattr('role', 'equalto', 'teacher')|list)|length if users else 0 }}</h3>
                        <p>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</p>
                    </div>
                </div>
            </div>
            
            <div class="users-search animate-on-scroll" data-animation="fadeInUp" data-delay="100">
                <input type="text" id="userSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
                <div class="search-icon">üîç</div>
            </div>
            
            <div class="users-grid" id="usersGrid">
                {% for user in users %}
                <div class="user-card animate-on-scroll" data-animation="fadeInUp" data-delay="{{ loop.index * 50 }}">
                    <div class="user-avatar">
                        <div class="avatar-placeholder">
                            {{ user.nickname[0] | upper if user.nickname else 'U' }}
                        </div>
                        {% if user.is_online %}
                        <div class="online-indicator"></div>
                        {% endif %}
                    </div>
                    
                    <div class="user-info">
                        <h3 class="user-name">{{ user.nickname or user.login }}</h3>
                        
                        {% if user.role and user.role != 'student' %}
                        <div class="user-badge user-{{ user.role }}">
                            {% if user.role == 'teacher' %}
                            üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
                            {% elif user.role == 'admin' %}
                            ‚ö° –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                            {% elif user.role == 'moderator' %}
                            üõ°Ô∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä
                            {% else %}
                            {{ user.role }}
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        <div class="user-stats">
                            <div class="stat">
                                <span class="stat-value">{{ user.courses|length if user.courses else 0 }}</span>
                                <span class="stat-label">–∫—É—Ä—Å–æ–≤</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">{{ user.gamificationRecord.points if user.gamificationRecord else 0 }}</span>
                                <span class="stat-label">–æ—á–∫–æ–≤</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">{{ user.role or '–°—Ç—É–¥–µ–Ω—Ç' }}</span>
                                <span class="stat-label">—Ä–æ–ª—å</span>
                            </div>
                        </div>
                        
                        {% if user.profile and user.profile.achievements %}
                        <div class="user-skills">
                            {% for achievement in user.profile.achievements[:3] %}
                            <span class="skill-tag">{{ achievement.name[:10] }}{% if achievement.name|length > 10 %}...{% endif %}</span>
                            {% endfor %}
                            {% if user.profile.achievements|length > 3 %}
                            <span class="skill-tag">+{{ user.profile.achievements|length - 3 }}</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="user-actions">
                        <a href="{{ url_for('user_profile', login=user.login) }}" class="btn btn-small">
                            –ü—Ä–æ—Ñ–∏–ª—å
                        </a>
                        {% if user.is_online %}
                        <span class="online-status">Online</span>
                        {% else %}
                        <span class="offline-status">
                            Offline
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            {% if users|length == 0 %}
            <div class="no-users animate-on-scroll" data-animation="fadeInUp">
                <div class="no-users-icon">üë•</div>
                <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p>–ë—É–¥—å –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É!</p>
                <a href="#register" class="btn btn-pink" onclick="showRegisterModal()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
            {% endif %}
            
            <div class="users-pagination animate-on-scroll" data-animation="fadeInUp">
                <a href="{{ url_for('index') }}" class="btn">
                    ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
                </a>
                <div class="pagination-info">
                    –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ users|length }}
                </div>
            </div>
        </section>
    </div>
    
    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–ª—è footer -->
    <div id="footer-placeholder"></div>

    <script>
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        document.getElementById('userSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const userCards = document.querySelectorAll('.user-card');
            
            userCards.forEach(card => {
                const userName = card.querySelector('.user-name').textContent.toLowerCase();
                if (userName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // –ê–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
        document.addEventListener('DOMContentLoaded', function() {
            const animatedElements = document.querySelectorAll('.animate-on-scroll');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const animation = entry.target.getAttribute('data-animation');
                        const delay = entry.target.getAttribute('data-delay') || 0;
                        
                        setTimeout(() => {
                            entry.target.classList.add('animate__animated', `animate__${animation}`);
                        }, parseInt(delay));
                        
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            animatedElements.forEach(el => observer.observe(el));
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegisterModal() {
            const modal = document.getElementById('registerModal');
            if (modal) modal.style.display = 'flex';
        }
    </script>

    <script src="{{ url_for('static', path='js/script.js') }}"></script>
    <script src="{{ url_for('static', path='js/templateLoader.js') }}"></script>
</body>
</html>