<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberskill | –ö–∏–±–µ—Ä–ø–∞–Ω–∫ –æ–±—É—á–µ–Ω–∏–µ 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', path='css/main.css') }}">
    <!-- –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Å–µ–∫—Ü–∏–π -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
</head>
<body>
    <div class="matrix-rain" id="matrixRain"></div>
    
    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–ª—è header -->
    <div id="header-placeholder"></div>
    
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="animate__animated animate__fadeInDown">–ë—É–¥—É—â–µ–µ <span>–æ–±—É—á–µ–Ω–∏—è</span> —É–∂–µ –∑–¥–µ—Å—å</h1>
                <p class="animate__animated animate__fadeIn animate__delay-1s">–û—Å–≤–æ–π—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±—É–¥—É—â–µ–≥–æ —Å –Ω–∞—à–∏–º–∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∫—É—Ä—Å—ã –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é, –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É –∏ –º–Ω–æ–≥–æ–º—É –¥—Ä—É–≥–æ–º—É.</p>
                <div class="hero-buttons animate__animated animate__fadeInUp animate__delay-2s">
                    <a href="{{ url_for('courses') }}" class="btn">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
                    <a href="#test" class="btn btn-pink">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</a>
                </div>
            </div>
        </div>
    </section>
    
    <section class="johnny-section" id="about">
        <div class="container johnny-container">
            <div class="johnny-image" id="johnnyImage">
                <div class="johnny-placeholder">
                    <img src="{{ url_for('static', path='img/johnny_sqr.jpg') }}" alt="Johnny Silverhand">
                </div>
            </div>
            <div class="johnny-text" id="johnnyText">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–∏–±–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</h2>
                <p>–í 2025 –≥–æ–¥—É —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏–∑–º–µ–Ω–∏–ª–∏ –≤—Å—ë. –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –∫–∏–±–µ—Ä-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤–æ–π –º–∏—Ä. –ù–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Å–≤–æ–µ–Ω–∏—è —Å–∞–º—ã—Ö –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤ –±—É–¥—É—â–µ–≥–æ.</p>
                <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É –∫–∏–±–µ—Ä–ø–∏–æ–Ω–µ—Ä–æ–≤ –∏ –Ω–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –≤ –º–∏—Ä–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —É–∂–µ —Å–µ–≥–æ–¥–Ω—è.</p>
                <a href="{{ url_for('courses') }}" class="btn">–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã</a>
            </div>
        </div>
    </section>
    
    <section class="courses" id="courses">
        <div class="container">
            <div class="section-title">
                <h2>–ù–∞—à–∏ –∫—É—Ä—Å—ã</h2>
            </div>
            
            <h3 class="course-category">–ë–∞–∑–æ–≤—ã–µ –∫—É—Ä—Å—ã</h3>

            <div class="courses-grid">
                {% for course in beginners_courses %}
                <div class="course-card animate-on-scroll" data-animation="fadeInUp">
                    <div class="course-icon">üêç</div>
                    <h3>{{ course.name }}</h3>
                    <p>{{ course.description }}</p>
                    <div class="course-meta">
                        <span>{{ course.topics | count }}</span>
                        <span class="course-level">{{ course.course_lvl.value }}</span>
                    </div>
                </div>
                {% endfor %}
                
            </div>
            
            <h3 class="course-category">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∫—É—Ä—Å—ã</h3>
            <div class="courses-grid">
                {% for course in pro_courses %}
                <div class="course-card animate-on-scroll" data-animation="fadeInUp">
                    <div class="course-icon">üêç</div>
                    <h3>{{ course.name }}</h3>
                    <p>{{ course.description }}</p>
                    <div class="course-meta">
                        <span>{{ course.topics | count }}</span>
                        <span class="course-level">{{ course.course_lvl.value }}</span>
                    </div>
                </div>
                {% endfor %}
                
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <a href="{{ url_for('courses') }}" class="btn">–í—Å–µ –∫—É—Ä—Å—ã</a>
            </div>
        </div>
    </section>
    
    <section class="test-section" id="test">
        <div class="container">
            <div class="section-title">
                <h2>–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏</h2>
            </div>
            
            <div class="test-container animate-on-scroll" data-animation="zoomIn">
                <h2>"–•–æ—á–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–±—è?"</h2>
                <p>–ü—Ä–∏–º–∏ –≤—ã–∑–æ–≤ –∏ –ø—Ä–æ–π–¥–∏ –Ω–∞—à —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±—É—á–µ–Ω–∏—é.</p>
                <a href="{{ url_for('test') }}" class="btn btn-pink">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</a>
            </div>
        </div>
    </section>

    <section class="leaderboard-section" id="leaderboard">
        <div class="container">
            <div class="section-title">
                <h2>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h2>
            </div>
            
            <div class="leaderboard-container animate-on-scroll" data-animation="fadeInLeft">
                <div class="leaderboard-header">
                    <span>–†–∞–Ω–≥</span>
                    <span>–ò–≥—Ä–æ–∫</span>
                    <span>–û—á–∫–∏</span>
                </div>
                <div class="leaderboard-list" id="leaderboardList">
                    
                    {% for leader in leaders %}
                    <div class="leaderboard-item top-{{ leader.position }}">
                                <span class="rank">{{ leader.position }}</span>
                                <span class="player">{{ leader.nickname }}</span>
                                <span class="points">{{ leader.points }}</span>
                    </div>

                    {% endfor %}



                </div>
            </div>
        </div>
    </section>
    
    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–ª—è footer -->
    <div id="footer-placeholder"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <button class="close-modal" id="closeLoginModal">&times;</button>
            <h2 class="modal-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">–õ–æ–≥–∏–Ω</label>
                    <input type="login" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn" id="loginBtn" style="width: 100%;">–í–æ–π—Ç–∏</button>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button id="forgotPasswordBtn" class="btn-link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</button>
                </div>
            </form>
        </div>
    </div>

<div class="modal" id="registerModal">
    <div class="modal-content">
        <button class="close-modal" id="closeRegisterModal">&times;</button>
        <h2 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form id="registerForm">
            <div class="form-group">
                <label for="registerLogin">–õ–æ–≥–∏–Ω</label>
                <input type="text" id="registerLogin" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="registerPassword" required>
            </div>
                <input type="checkbox" id="permission">–Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö
            
            <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π/–∞–¥–º–∏–Ω–æ–≤ -->
            <div id="adminSection" style="display: none;">
                <div class="form-group">
                    <label for="secretCode">–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥</label>
                    <input type="password" id="secretCode" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥">
                </div>
                <div class="form-group">
                    <label for="userRole">–†–æ–ª—å</label>
                    <select id="userRole">
                        <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                        <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
            </div>
            
            <button type="submit" class="btn" style="width: 100%;" id="reg_btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        
        <div style="text-align: center; margin-top: 15px;">
            <button id="toggleAdminBtn" class="btn-link">–í—ã –Ω–µ —É—á–µ–Ω–∏–∫?</button>
        </div>
    </div>
</div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è -->
    <div class="modal" id="forgotPasswordModal">
        <div class="modal-content">
            <button class="close-modal" id="closeForgotPasswordModal">&times;</button>
            <h2 class="modal-title">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h2>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotPasswordEmail">Email</label>
                    <input type="email" id="forgotPasswordEmail" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </form>
        </div>
    </div>

    
    <script src="{{ url_for('static', path='js/script.js') }}"></script>
    <script src="{{ url_for('static', path='js/templateLoader.js') }}"></script>

    <script>
        const login_btn = document.getElementById("loginBtn")
        const login = document.getElementById("loginEmail")
        const password = document.getElementById("loginPassword")

        login_btn.addEventListener("click", async () => {
            const formData = new FormData();
            formData.append('username', login.value);
            formData.append('password', password.value);
            
            try {
                const response = await fetch('/auth/login/', {
                    method: 'POST',
                    body: new URLSearchParams(formData),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                });
                
                if (response.ok) {
                    const tokenData = await response.json();
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                    localStorage.setItem('access_token', tokenData.access_token);
                    alert('Login successful!');
                    loadUserInfo();
                } else {
                    alert('Login failed!');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        })
    </script>


    <script>
        const reg_btn = document.getElementById("reg_btn")
        const regLogin = document.getElementById("registerLogin")
        const regPassword = document.getElementById("registerPassword")
        const email = document.getElementById("registerEmail")
        const permission = document.getElementById("permission")

        reg_btn.addEventListener("click", async () => {
            
            if (!permission.checked) {
                alert("–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö")
                return;
            }
            

        const requestBody = {
            nickname: regLogin.value,
            login: regLogin.value,
            password: regPassword.value,
            email: email.value
        };

            
            try {
                const response = await fetch('/auth/register/', {
                    method: 'POST',
                    body: JSON.stringify(requestBody),
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!!');
                    loadUserInfo();
                } else {
                    alert('Register failed!');
                }
            } catch (error) {
                console.error('Error:', error);
            }
            

        })

    </script>

<script>
// –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT
function parseJwt(token) {
    try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => 
            '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
        ).join(''));
        return JSON.parse(jsonPayload);
    } catch (e) {
        return null;
    }
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function updateAuthUI() {
    const token = localStorage.getItem('access_token');
    if (!token) return;
    
    localStorage.clear()

    const payload = parseJwt(token);
    if (!payload || !payload.login) return;

    const login = payload.login;

    // –ñ–¥—ë–º, –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è header
    const checkHeader = setInterval(() => {
        const header = document.querySelector('header'); // –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        if (!header) return;

        clearInterval(checkHeader);

        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–µ–∫—Å—Ç—É (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã)
        const buttons = Array.from(header.querySelectorAll('button, a'));
        const loginBtn = buttons.find(btn => btn.textContent.includes('–í—Ö–æ–¥'));
        const registerBtn = buttons.find(btn => btn.textContent.includes('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'));

        if (loginBtn && registerBtn) {
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
            loginBtn.style.display = 'none';
            registerBtn.style.display = 'none';

            // –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å
            const profileLink = document.createElement('a');
            profileLink.href = `/users/${login}`;
            profileLink.className = 'profile-link'; // —Å—Ç–∏–ª–∏–∑—É–π –∫–∞–∫ —Ö–æ—á–µ—à—å
            profileLink.innerHTML = `
                <img src="/static/img/avatars/avatar1.jpg" alt="avatar" style="width:32px;height:32px;border-radius:50%;vertical-align:middle;margin-right:5px;">
                <span>${login}</span>
            `;

            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –∫–Ω–æ–ø–æ–∫ (–∏–ª–∏ –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ)
            loginBtn.parentNode.insertBefore(profileLink, loginBtn.nextSibling);
        }
    }, 100);
}

document.addEventListener('DOMContentLoaded', updateAuthUI);
</script>

</body>
</html>